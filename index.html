<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chat</title>
  <style>
    body {
      background-color: #0b1f3a;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    #chat-box {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      border-bottom: 1px solid #1e3a5f;
    }
    .message {
      margin-bottom: 15px;
    }
    .username {
      font-weight: bold;
      color: #81a8cd;
    }
    #input-area {
      display: flex;
      padding: 10px;
      background-color: #102d4a;
    }
    input, button {
      padding: 10px;
      border: none;
      outline: none;
      border-radius: 5px;
      font-size: 1em;
    }
    #message-input {
      flex: 1;
      background-color: #1a3a5d;
      color: white;
      margin-right: 10px;
    }
    #send-button {
      background-color: #1f5f8b;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    #send-button:hover {
      background-color: #347cbf;
    }
  </style>
</head>
<body>

<div id="chat-box"></div>
<div id="input-area">
  <input type="text" id="message-input" placeholder="Type a message..." />
  <button id="send-button">Send</button>
</div>

<script>
  const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbwRw5uSLfrrz-21Xynl8DNIMBkBhFJUrC9LX5vgi_Jp82Ck45XXk38xDlHCtAexqymOxg/exec'; // Replace with your Apps Script web app URL
  const chatBox = document.getElementById("chat-box");
  const messageInput = document.getElementById("message-input");
  const sendButton = document.getElementById("send-button");

  let username = localStorage.getItem("chat-username");
  if (!username) {
    username = prompt("Enter your name:");
    localStorage.setItem("chat-username", username || "Anonymous");
  }

  function escapeHTML(str) {
    const div = document.createElement("div");
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
  }

  function fetchMessages() {
    fetch(SHEET_API_URL)
      .then(res => res.json())
      .then(data => {
        chatBox.innerHTML = "";
        data.forEach(msg => {
          const msgDiv = document.createElement("div");
          msgDiv.className = "message";
          msgDiv.innerHTML = `<span class="username">${escapeHTML(msg.username)}</span>: ${escapeHTML(msg.message)}`;
          chatBox.appendChild(msgDiv);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
      });
  }

  function sendMessage() {
    const msg = messageInput.value.trim();
    if (!msg) return;
    fetch(SHEET_API_URL, {
      method: "POST",
      body: JSON.stringify({ username, message: msg }),
      headers: { "Content-Type": "application/json" }
    }).then(() => {
      messageInput.value = "";
      fetchMessages();
    });
  }

  sendButton.onclick = sendMessage;
  messageInput.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });

  setInterval(fetchMessages, 500); // Poll every 3 seconds
  fetchMessages();
</script>

</body>
</html>
